<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TablesMathAssist</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body {
    font-family:"Segoe UI",Arial,Helvetica,sans-serif;
    background: linear-gradient(to bottom, #fff, #aaf);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #header {
    display: flex; justify-content: space-between; align-items: center;
    width: 100%; max-width: 1000px; padding: 10px;
  }
  #logo-container {
    display: flex; align-items: center; justify-content: flex-start;
  }
  #logo {
    height: 50px; margin-right: 10px;
  }
  #title {
    flex-grow: 1; text-align: center; font-size: 2em; font-weight: bold; color:#222;
  }
  #modeToggle {
    cursor: pointer; font-size: 1.5em; padding: 5px 10px; border: none; border-radius: 8px; background: #0af; color: #fff;
  }
  #content {
    width: 100%; max-width: 1000px; display: flex; flex-direction: column; align-items: center; padding: 10px;
  }
  #welcome {
    margin: 20px;
    text-align: center;
    font-size: 1.2em;
  }
  #settings {
    width: 100%; max-width: 900px;
    display: flex; flex-direction: column; gap: 10px; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 8px;
  }
  label {
    display: flex; flex-direction: column; font-size: 1em; color:#222;
  }
  select, input[type=number], input[type=checkbox] {
    margin-top: 5px; padding: 4px; font-size: 1em; border-radius: 4px; border: 1px solid #888;
  }
  #btnStart {
    margin: 15px; padding: 12px; font-size: 1.2em; border: none; border-radius: 8px; background:#4CAF50; color:#fff; cursor:pointer;
  }
  #timer {
    font-size: 2em; margin: 10px 0;
  }
  #question {
    font-size: 3em; margin: 20px 0;
  }
  #answer {
    font-size: 2em; padding: 10px; width: 100px; text-align: center;
  }
  #btnOk {
    margin-top: 15px; padding: 10px 20px; font-size: 1.2em; border: none; border-radius: 8px; background:#0f0; cursor:pointer;
  }
  #results {
    display: none; margin-top: 20px; width: 100%; text-align: center; background: rgba(255,255,255,0.3); padding: 20px; border-radius:8px;
  }
  #results h2 {
    font-size: 1.5em; margin-bottom: 10px;
  }
  #results ul {
    list-style-type: none; padding: 10px;
  }
  #results li {
    margin: 5px 0;
  }
  #grid-container {
    margin-top: 20px;
    display: flex; flex-wrap: wrap; justify-content: center; display: none;
  }
  table { border-collapse: collapse; }
  td, th {
    border: 1px solid #555; width: 40px; height: 40px; text-align: center; font-size: 1em;
  }
  /* Progress bar */
  #progressBarContainer {
    width: 90%; max-width: 400px; height: 10px; background: #555; border-radius: 5px; margin: 10px 0;
  }
  #progressBar {
    height: 10px; width: 0%; background: #0af; border-radius: 5px; transition: width 0.3s;
  }
  /* Night mode theme override */
  body.night {
    background: linear-gradient(to bottom, #000, #222);
    color: #eee;
  }
  body.night #header, body.night #settings {
    background: #222;
  }
  body.night #question {
    color: #fff;
  }
</style>
</head>
<body>
<div id="header">
  <div id="logo-container">
    <img id="logo" src="logofondtransparentnew-A1.jpg" alt="Logo DSR" />
  </div>
  <div id="title">TablesMathAssist</div>
  <button id="modeToggle">üåô</button>
</div>

<div id="welcome">
  <p>Bienvenue ! Choisis tes r√©glages et commence ton entra√Ænement ou mieux !!! Le test et gagne la coupe üèÜ</p>
</div>

<div id="content">
  <div id="settings">
    <label>Nombre de questions :
      <select id="questionsCount"></select>
    </label>
    <label>Temps pour ta s√©rie de <span id="questionsCountLabel">x</span> questions :
      <select id="timePerSeries"></select>
    </label>
    <label>
      <input type="checkbox" id="modeTraining"> Mode entra√Ænement (sans chrono)
    </label>
    <button id="startBtn">Commencer le test</button>
  </div>

  <div id="questionArea" style="display:none; text-align:center;">
    <div id="progressBarContainer"><div id="progressBar"></div></div>
    <div id="question"></div>
    <input type="number" id="answer" autocomplete="off" inputmode="numeric" />
    <div>
      <button id="okBtn">Valider</button>
    </div>
  </div>

  <div id="results">
    <h2>R√©sultats</h2>
    <ul>
      <li id="score">Score : 0 / 0</li>
      <li id="correctCount">Correctes : 0</li>
      <li id="wrongCount">Incorrectes : 0</li>
      <li id="missedCount">Non r√©pondues : 0</li>
    </ul>
    <div id="gridContainer" style="margin-top:20px;">
      <table id="grid"></table>
    </div>
    <button id="restartBtn">Nouvelle s√©ance</button>
  </div>

</div>

<div id="footer" style="margin-top:20px; text-align:center;">
  <p>Con√ßu et d√©velopp√© par DSR / edlam.dsr@gmail.com</p>
</div>

<script>
/* Variables globales */
let questions = [], reponses = [], score = 0, currentQuestion = 0;
let totalQuestions = 10;
let totalTime = 30; // en secondes, par d√©faut
let timerID;
let isTrainingMode = false;
let questionsCount = 10;
let timePerSeries = 30; // sec
let questionsOptions = [];
let timeOptions = [];

/* Initialiser s√©lecteurs questions et temps */
const questionsSelect = document.getElementById('questionsCount');
const timeSelect = document.getElementById('timePerSeries');
const questionsLabel = document.getElementById('questionsCountLabel');
const startBtn = document.getElementById('startBtn');
const answerInput = document.getElementById('answer');
const questionDiv = document.getElementById('question');
const questionArea = document.getElementById('questionArea');
const resultsDiv = document.getElementById('results');
const progressBar = document.getElementById('progressBar');
const modeCheckbox = document.getElementById('modeTraining');
const modeBtn = document.getElementById('modeToggle');

/* populate questions options 10-500 step 10 */
for(let i=10; i<=500; i+=10){ questionsOptions.push(i); }
questionsOptions.forEach(q => {
  let opt = document.createElement('option');
  opt.value = q;
  opt.innerText = q;
  questionsSelect.appendChild(opt);
});
/* populate time options 30sec to 20min step 1min */
for(let t=30; t<=1200; t+=60){
  let opt = document.createElement('option');
  let minutes = t/60;
  opt.value = t;
  opt.innerText = minutes + ' min';
  timeSelect.appendChild(opt);
}

/* gestion mode jour/nuit */
let isNight = false;
const modeBtn = document.getElementById('modeToggle');
modeBtn.addEventListener('click', ()=>{
  document.body.classList.toggle('night');
  isNight = !isNight;
  modeBtn.innerText = isNight ? '‚òÄÔ∏è' : 'üåô';
});

/* gestion changement questions et temps pour mise √† jour du label */
questionsSelect.addEventListener('change', () => {
  questions = [];
  questionsCount = parseInt(questionsSelect.value);
  questionsLabel.innerText = questionsCount;
});
timeSelect.addEventListener('change', () => {
  timePerSeries = parseInt(timeSelect.value);
});
/* initialisation des valeurs */
questionsSelect.value = 10;
questions = [];
questionsCount = 10;
questionsLabel.innerText = questionsCount;
timeSelect.value = 30;
timePerSeries = 30;

/* bouton d√©marrage */
startBtn.addEventListener('click', () => {
  questions = [];
  reponses = [];
  score = 0;
  currentQuestion = 0;
  document.getElementById('score').innerText = `Score : 0 / ${questionsCount}`;
  document.getElementById('correctCount').innerText = `Correctes : 0`;
  document.getElementById('wrongCount').innerText = `Incorrectes : 0`;
  document.getElementById('missedCount').innerText = `Non r√©pondues : 0`;
  document.getElementById('gridContainer').style.display = 'none';
  questionArea.style.display = 'block';
  resultsDiv.style.display = 'none';
  // cr√©er questions
  for(let i=0; i<questionsCount; i++){
    let a = Math.floor(Math.random()*12)+1;
    let b = Math.floor(Math.random()*12)+1;
    questions.push({a, b, correct: a*b});
    reponses.push(null);
  }
  currentQuestion = 0;
  afficherQuestion();
  siModeNuitSinonJour();
  if(!modeCheckbox.checked){
    startTimer();
  }
});

/* affichage question */
function afficherQuestion(){
  if(currentQuestion >= questions.length){
    finQuestion();
    return;
  }
  document.getElementById('question').innerText = `${questions[currentQuestion].a} √ó ${questions[currentQuestion].b} = ?`;
  answerInput.value='';
  answerInput.focus();
  updateProgress();
}

/* timer */
function startTimer() {
  clearInterval(timerID);
  let t = isTrainingMode ? 9999999 : timePerSeries;
  let startTime = Date.now();
  timerID = setInterval(()=>{
    let elapsed = Math.floor((Date.now() - startTime)/1000);
    let remaining = t - elapsed;
    if(remaining <= 0){
      clearInterval(timerID);
      finQuestion();  
    }
    document.getElementById('timerDisplay') && (document.getElementById('timerDisplay').innerText = 'Temps restant : ' + remaining + ' s');
  }, 1000);
}

/* validation r√©ponse */
document.getElementById('okBtn').addEventListener('click', () => {
  const reponse = parseInt(answerInput.value);
  if(!isNaN(reponse)){
    reponses[currentQuestion] = reponse;
    if(reponse === questions[currentQuestion].correct){
      score++;
    }
  } else {
    reponses[currentQuestion] = null;
  }
  // passer √† la question suivante
  currentQuestion++;
  document.getElementById('score').innerText = `Score : ${score} / ${questions.length}`;
  if(currentQuestion>=questions.length){
    clearInterval(timerID);
    afficherResultats();
  }else{
    afficherQuestion();
  }
});

/* fin question (temps √©coul√© ou termin√© questions) */
function finQuestion(){
  clearInterval(timerID);
  // compter r√©ponses manqu√©es
  reponses.forEach((r, i)=>{ if(r===null) reponses[i]=0; });
  afficherResultats();
}

/* affichage r√©sultats */
function afficherResultats(){
  questionArea.style.display='none';
  document.getElementById('gridContainer').style.display='block';
  resultsDiv.style.display='block';
  document.getElementById('score').innerText = `Score : ${score} / ${questions.length}`;
  document.getElementById('correctCount').innerText = `Correctes : ${questions.filter((q,i)=>reponses[i]===q.correct).length}`;
  document.getElementById('wrongCount').innerText = `Incorrectes : ${questions.filter((q,i)=>reponses[i]>0 && reponses[i]!==q.correct).length}`;
  document.getElementById('missedCount').innerText = `Non r√©pondues : ${questions.filter((r,i)=>r===0).length}`;

  // affichage grille
  const table = document.getElementById('grid');
  table.innerHTML='';
  for(let a=1; a<=12; a++){
    const row = document.createElement('tr');
    for(let b=1;b<=12;b++){
      const cell = document.createElement('td');
      const index = questions.findIndex(q=>q.a===a && q.b===b);
      let val = reponses[index];
      if(val===null || val===undefined) val=0;
      cell.innerText = val;
      if(val !== questions[index].correct && val!==0){
        cell.style.background = '#f88'; // rouge
      } else if(val===0){
        cell.style.background = '#ff0'; // orange
      }
      row.appendChild(cell);
    }
    table.appendChild(row);
  }
}

/* bouton nouvelle s√©ance */
document.getElementById('restartBtn').addEventListener('click', () => {
  document.getElementById('startBtn').click();
});

/* progress bar */
function updateProgress() {
  const progress = (currentQuestion / questions.length)*100;
  document.getElementById('progressBar').style.width= progress+'%';
}

</script>
</body>
</html>
