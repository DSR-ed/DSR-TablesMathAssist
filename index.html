<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TablesMathAssist - DSR</title>
  <style>
    /* Votre CSS complet + ajouts apprentissage */
    :root {
      --gradient-day: linear-gradient(180deg, #ffffff 0%, #e3f2fd 100%);
      --gradient-night: linear-gradient(180deg, #000000 0%, #0d47a1 100%);
      --text-day: #1a1a1a;
      --text-night: #ffffff;
      --accent-day: #1976d2;
      --accent-night: #00bcd4;
      --card-day: rgba(0, 0, 0, 0.05);
      --card-night: rgba(255, 255, 255, 0.1);
    }
    body {
      font-family: "Segoe UI", Arial, Helvetica, sans-serif;
      background: var(--gradient-night);
      color: var(--text-night);
      transition: all .3s;
    }
    body.day-mode {
      background: var(--gradient-day);
      color: var(--text-day);
    }
    .app-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    .header {
      width: 100%;
      max-width: 1200px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 20px;
      background: var(--card-night);
      border-radius: 15px;
      backdrop-filter: blur(10px);
    }
    body.day-mode .header { background: var(--card-day);}
    .header-logo img {
      height: 60px;
      width: auto;
    }
    .app-title {
      font-size: 2.5rem;
      font-weight: bold;
      color: var(--accent-night);
      text-align: center;
      flex: 1;
    }
    body.day-mode .app-title { color: var(--accent-day);}
    .btn-theme {
      background: none;
      border: 2px solid var(--accent-night);
      border-radius: 50%;
      width: 50px; height: 50px;
      cursor: pointer;
      font-size: 1.5rem;
      transition: all .3s;
    }
    body.day-mode .btn-theme { border-color: var(--accent-day);}
    .btn-theme:hover { transform: scale(1.1); background: var(--accent-night);}
    body.day-mode .btn-theme:hover { background: var(--accent-day);}
    .card {
      background: var(--card-night);
      border-radius: 20px;
      padding: 30px;
      margin: 15px 0;
      width: 100%; max-width: 800px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    body.day-mode .card { background: var(--card-day);}
    .welcome-message {
      text-align: center; font-size: 1.3rem; line-height: 1.6;
    }
    .settings-panel h2 {
      color: var(--accent-night); margin-bottom: 25px;
      font-size: 2rem; text-align: center;
    }
    body.day-mode .settings-panel h2 { color: var(--accent-day);}
    .form-group { margin-bottom: 25px;}
    .form-label {
      display: block; font-size: 1.2rem; font-weight: bold; margin-bottom: 10px; color: var(--accent-night);
    }
    body.day-mode .form-label { color: var(--accent-day);}
    .tables-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 10px; margin-top: 10px;
    }
    .tables-selector label {
      display: flex; align-items: center; font-size: 1.1rem; cursor: pointer; padding: 8px; border-radius: 8px;
      transition: background .3s;
    }
    .tables-selector input[type="checkbox"] {
      margin-right: 8px; transform: scale(1.2);
      accent-color: var(--accent-night);
    }
    body.day-mode .tables-selector input[type="checkbox"] { accent-color: var(--accent-day);}
    select {
      width: 100%; padding: 12px;
      font-size: 1.1rem;
      border: 2px solid var(--accent-night);
      border-radius: 10px;
      background: var(--card-night);
      color: var(--text-night);
      cursor: pointer;
    }
    body.day-mode select {
      border-color: var(--accent-day);
      background: var(--card-day);
      color: var(--text-day);
    }
    .btn-primary {
      background: var(--accent-night); color: white;
      border: none; padding: 15px 30px; font-size: 1.3rem; font-weight: bold;
      border-radius: 15px;
      cursor: pointer; transition: all .3s;
      margin: 10px;
    }
    body.day-mode .btn-primary { background: var(--accent-day);}
    .btn-primary:hover { transform: translateY(-2px);}
    
    /* ========== STYLES APPRENTISSAGE ========== */
    #learnPage, #tableDetailPage { display: none; }
    .learn-title, .table-detail-title {
      font-size: 2rem; font-weight: bold; margin-bottom: 5px; text-align: center;
      color: var(--text-night);
    }
    body.day-mode .learn-title, body.day-mode .table-detail-title { color: var(--text-day); }
    .learn-sub, .table-detail-sub {
      font-size: 1.1rem; text-align: center; margin-bottom: 25px;
      color: var(--text-night);
    }
    body.day-mode .learn-sub, body.day-mode .table-detail-sub { color: var(--text-day); }
    .legend {
      display: flex; justify-content: center; gap: 20px; margin-bottom: 25px; 
      font-weight: 600; color: var(--text-night);
    }
    body.day-mode .legend { color: var(--text-day); }
    .legend span { display: flex; align-items: center; gap: 6px; }
    .legend i { width: 14px; height: 14px; border-radius: 50%; display: inline-block; }
    .grid-tables {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 18px;
    }
    .table-card {
      background: rgba(255, 255, 255, 0.9);
      border: 3px solid;
      border-radius: 15px;
      padding: 25px 10px;
      text-align: center;
      font-weight: bold;
      cursor: pointer;
      transition: all .25s;
      color: #333;
    }
    body.day-mode .table-card {
      background: rgba(255, 255, 255, 0.95);
    }
    .table-card:hover { transform: translateY(-4px); }
    .table-num { font-size: 2rem; margin-bottom: 8px; }
    .diff-label { font-size: 0.9rem; font-weight: 600; }
    .easy { border-color: #4caf50; }
    .medium { border-color: #ff9800; }
    .hard { border-color: #f44336; }

    /* Page d√©tail table */
    .table-detail-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 25px;
    }
    .btn-astuce {
      background: #4285f4; color: white;
      border: none; padding: 10px 20px; font-size: 1.1rem; font-weight: bold;
      border-radius: 10px; cursor: pointer; transition: all .3s;
      display: flex; align-items: center; gap: 8px;
    }
    .btn-astuce:hover { background: #3367d6; }
    .btn-return {
      background: #6c757d; color: white;
      border: none; padding: 10px 20px; font-size: 1.1rem; font-weight: bold;
      border-radius: 10px; cursor: pointer; transition: all .3s;
    }
    .btn-return:hover { background: #5a6268; }
    .multiplication-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
    }
    .mult-card {
      background: #4285f4;
      color: white;
      border-radius: 12px;
      padding: 20px 10px;
      text-align: center;
      font-weight: bold;
      font-size: 1.1rem;
    }
    .mult-question {
      font-size: 1.2rem;
      margin-bottom: 8px;
    }
    .mult-answer {
      font-size: 1.8rem;
      color: #ffd700;
    }

    /* ========== MODAL ASTUCES ULTRA CORRIG√âE ========== */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0, 0, 0, 0.85);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .modal-overlay.active { display: flex; }
    
    .modal-content {
      /* MODE NUIT : Fond noir pur OPAQUE */
      background: #000000;
      opacity: 1.0;
      border: 3px solid #00bcd4;
      border-radius: 15px;
      padding: 30px;
      max-width: 90vw;
      width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 10px 40px rgba(0, 255, 255, 0.4);
    }
    
    /* MODE JOUR : Fond gris clair OPAQUE */
    body.day-mode .modal-content { 
      background: #f5f5f5;
      opacity: 1.0;
      border: 3px solid #1976d2;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
    }
    
    .modal-close {
      position: absolute;
      top: 12px; right: 18px;
      background: none; border: none;
      font-size: 2rem; cursor: pointer;
      color: #00bcd4;
      font-weight: bold;
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    body.day-mode .modal-close { color: #1976d2; }
    .modal-close:hover {
      color: #ff4444;
      transform: scale(1.3);
      background: rgba(255, 68, 68, 0.1);
      border-radius: 50%;
    }
    
    .modal-title {
      font-size: 1.6rem; font-weight: bold;
      margin-bottom: 20px; text-align: center;
      color: #00bcd4;
      padding-right: 40px;
    }
    body.day-mode .modal-title { color: #1976d2; }
    
    .astuce-list {
      list-style: none; padding: 0; margin: 0;
    }
    .astuce-list li {
      margin-bottom: 15px; 
      padding: 12px 15px;
      font-size: 1.1rem; 
      line-height: 1.5;
      /* MODE NUIT : Texte blanc pur sur fond noir */
      color: #ffffff;
      background: rgba(0, 188, 212, 0.1);
      border-radius: 8px;
      border-left: 4px solid #00bcd4;
    }
    
    /* MODE JOUR : Texte noir fonc√© sur fond gris clair */
    body.day-mode .astuce-list li { 
      color: #333333;
      background: rgba(25, 118, 210, 0.1);
      border-left: 4px solid #1976d2;
    }
    /* ========== FIN MODAL ASTUCES ULTRA CORRIG√âE ========== */

    .game-area, .results-area { display:none; text-align:center;}
    .progress-info {
      font-size:1.2rem;margin-bottom:20px;color: var(--accent-night);}
    body.day-mode .progress-info{ color: var(--accent-day);}
    .progress-bar { width:100%;height:10px;
      background: var(--card-night); border-radius:5px; margin-bottom:30px; overflow:hidden;}
    body.day-mode .progress-bar {background:var(--card-day);}
    .progress-fill{height:100%;background:var(--accent-night);width:0%;transition:width .3s;}
    body.day-mode .progress-fill{background:var(--accent-day);}
    .question { font-size: 3rem; font-weight: bold; margin: 30px 0; color: var(--accent-night);}
    body.day-mode .question{ color: var(--accent-day);}
    .answer-input { font-size:2rem; padding:15px; text-align:center; border:3px solid var(--accent-night);
      border-radius:15px; background:var(--card-night); color:var(--text-night); width:200px; margin:20px 0;}
    body.day-mode .answer-input{border-color:var(--accent-day);background:var(--card-day);color:var(--text-day);}
    .medal { font-size:4rem;margin:20px 0;}
    .results-grid {overflow-x:auto; margin:30px 0;}
    .results-grid table {
      margin:0 auto; border-collapse:collapse; font-size:0.9rem;}
    .results-grid th, .results-grid td {
      border:1px solid var(--accent-night); width:35px; height:35px; text-align:center; font-weight:bold;}
    body.day-mode .results-grid th,body.day-mode .results-grid td {border-color: var(--accent-day);}
    .results-grid th { background:var(--accent-night);color:white;}
    body.day-mode .results-grid th { background:var(--accent-day);}
    .cell-correct {background:transparent;}
    .cell-incorrect {background:#f44 !important;}
    .cell-missed {background:#ff0 !important;}
    @media (max-width:768px){
      .app-title{font-size:1.8rem;} .header{padding:15px;}
      .card{padding:20px;margin:10px;} .question{font-size:2rem;}
      .answer-input{font-size:1.5rem;width:150px;}
      .results-grid th, .results-grid td {width:25px;height:25px;font-size:0.8rem;}
      .table-num { font-size: 1.6rem; }
      .grid-tables { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); }
      .multiplication-grid { grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); }
      .modal-content { width: 95vw; padding: 25px; }
      .modal-title { font-size: 1.4rem; }
      .astuce-list li { font-size: 1rem; }
    }
    .footer {margin-top:auto;text-align:center;padding:30px;}
    .footer-logo img {height:40px;margin-bottom:10px;}
    .footer-text {font-size:0.9rem;opacity:0.8;}
    .hidden {display:none!important;}
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Header avec logo et bouton mode jour/nuit -->
    <header class="header">
      <div class="header-logo">
        <img src="logofTDSR.png" alt="Logo DSR" />
      </div>
      <h1 class="app-title">TablesMathAssist</h1>
      <button id="themeToggle" class="btn-theme"><span class="theme-icon">üåô</span></button>
    </header>

    <!-- ========== PAGE ACCUEIL (inchang√©e) ========== -->
    <div id="homePage">
      <!-- Message de bienvenue -->
      <div class="welcome-message card">
        <p>Choisis tes r√©glages et commences ton entra√Ænement ou mieux!!! Le test et gagnes la coupe. üèÜ</p>
      </div>

      <!-- Zone de param√®tres -->
      <section class="settings-panel card">
        <h2>R√©glages</h2>
        <div class="form-group">
          <label class="form-label">Tables √† r√©viser :</label>
          <div class="tables-selector">
            <label><input type="checkbox" value="1" checked> 1</label>
            <label><input type="checkbox" value="2" checked> 2</label>
            <label><input type="checkbox" value="3" checked> 3</label>
            <label><input type="checkbox" value="4" checked> 4</label>
            <label><input type="checkbox" value="5" checked> 5</label>
            <label><input type="checkbox" value="6" checked> 6</label>
            <label><input type="checkbox" value="7" checked> 7</label>
            <label><input type="checkbox" value="8" checked> 8</label>
            <label><input type="checkbox" value="9" checked> 9</label>
            <label><input type="checkbox" value="10" checked> 10</label>
            <label><input type="checkbox" value="11"> 11</label>
            <label><input type="checkbox" value="12"> 12</label>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label" id="timeLimitLabel">Temps pour ta s√©rie de 30 questions :</label>
          <select id="timeLimit">
            <option value="0.5">30 secondes</option>
            <option value="1">1 minute</option>
            <option value="2">2 minutes</option>
            <option value="3">3 minutes</option>
            <option value="4">4 minutes</option>
            <option value="5" selected>5 minutes</option>
            <option value="6">6 minutes</option>
            <option value="7">7 minutes</option>
            <option value="8">8 minutes</option>
            <option value="9">9 minutes</option>
            <option value="10">10 minutes</option>
            <option value="15">15 minutes</option>
            <option value="20">20 minutes</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Nombre de questions :</label>
          <select id="questionCount">
            <option value="10">10 questions</option>
            <option value="20">20 questions</option>
            <option value="30" selected>30 questions</option>
            <option value="40">40 questions</option>
            <option value="50">50 questions</option>
            <option value="60">60 questions</option>
            <option value="70">70 questions</option>
            <option value="80">80 questions</option>
            <option value="90">90 questions</option>
            <option value="100">100 questions</option>
            <option value="110">110 questions</option>
            <option value="120">120 questions</option>
            <option value="130">130 questions</option>
            <option value="140">140 questions</option>
            <option value="150">150 questions</option>
            <option value="160">160 questions</option>
            <option value="170">170 questions</option>
            <option value="180">180 questions</option>
            <option value="190">190 questions</option>
            <option value="200">200 questions</option>
            <option value="250">250 questions</option>
            <option value="300">300 questions</option>
            <option value="350">350 questions</option>
            <option value="400">400 questions</option>
            <option value="450">450 questions</option>
            <option value="500">500 questions</option>
          </select>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="noTimerMode"> Mode entra√Ænement (sans chrono)
          </label>
        </div>
        <button id="startGame" class="btn-primary">Commencer le Test</button>
        <button id="learnBtn" class="btn-primary" style="background: #8e24aa;">Apprentissage</button>
      </section>
    </div>

    <!-- ========== PAGE APPRENTISSAGE ========== -->
    <div id="learnPage" class="card">
      <h2 class="learn-title">Apprentissage des Tables de 1 √† 12</h2>
      <p class="learn-sub">Clique sur une table pour apprendre ses secrets !</p>

      <!-- L√©gende -->
      <div class="legend">
        <span><i style="background: #4caf50;"></i>Facile</span>
        <span><i style="background: #ff9800;"></i>Moyen</span>
        <span><i style="background: #f44336;"></i>Difficile</span>
      </div>

      <!-- Grille des tables -->
      <div class="grid-tables">
        <!-- FACILE -->
        <div class="table-card easy" data-num="1">
          <div class="table-num">1</div>
          Table de 1<br><span class="diff-label">FACILE</span>
        </div>
        <div class="table-card easy" data-num="2">
          <div class="table-num">2</div>
          Table de 2<br><span class="diff-label">FACILE</span>
        </div>
        <div class="table-card easy" data-num="5">
          <div class="table-num">5</div>
          Table de 5<br><span class="diff-label">FACILE</span>
        </div>
        <div class="table-card easy" data-num="10">
          <div class="table-num">10</div>
          Table de 10<br><span class="diff-label">FACILE</span>
        </div>
        <!-- MOYEN -->
        <div class="table-card medium" data-num="3">
          <div class="table-num">3</div>
          Table de 3<br><span class="diff-label">MOYEN</span>
        </div>
        <div class="table-card medium" data-num="4">
          <div class="table-num">4</div>
          Table de 4<br><span class="diff-label">MOYEN</span>
        </div>
        <div class="table-card medium" data-num="6">
          <div class="table-num">6</div>
          Table de 6<br><span class="diff-label">MOYEN</span>
        </div>
        <div class="table-card medium" data-num="9">
          <div class="table-num">9</div>
          Table de 9<br><span class="diff-label">MOYEN</span>
        </div>
        <div class="table-card medium" data-num="11">
          <div class="table-num">11</div>
          Table de 11<br><span class="diff-label">MOYEN</span>
        </div>
        <!-- DIFFICILE -->
        <div class="table-card hard" data-num="7">
          <div class="table-num">7</div>
          Table de 7<br><span class="diff-label">DIFFICILE</span>
        </div>
        <div class="table-card hard" data-num="8">
          <div class="table-num">8</div>
          Table de 8<br><span class="diff-label">DIFFICILE</span>
        </div>
        <div class="table-card hard" data-num="12">
          <div class="table-num">12</div>
          Table de 12<br><span class="diff-label">DIFFICILE</span>
        </div>
      </div>

      <!-- Bouton retour -->
      <div style="text-align: center; margin-top: 35px;">
        <button id="backHome" class="btn-primary">‚¨Ö Retour</button>
      </div>
    </div>

    <!-- ========== PAGE D√âTAIL TABLE ========== -->
    <div id="tableDetailPage" class="card">
      <div class="table-detail-header">
        <h2 id="tableDetailTitle" class="table-detail-title">Table de 2</h2>
        <div>
          <button id="showAstuceBtn" class="btn-astuce">üí° Astuce</button>
          <button id="backToLearnBtn" class="btn-return">‚Üê Retour</button>
        </div>
      </div>

      <!-- Grille des multiplications -->
      <div id="multiplicationGrid" class="multiplication-grid">
        <!-- G√©n√©r√© dynamiquement par JS -->
      </div>
    </div>

    <!-- ========== MODAL ASTUCES ========== -->
    <div id="astuceModal" class="modal-overlay">
      <div class="modal-content">
        <button id="closeAstuceModal" class="modal-close">√ó</button>
        <h3 id="astuceModalTitle" class="modal-title">Astuces Table de 2</h3>
        <ul id="astuceModalContent" class="astuce-list">
          <!-- G√©n√©r√© dynamiquement par JS -->
        </ul>
      </div>
    </div>

    <!-- Zone de jeu (inchang√©e) -->
    <section id="gameArea" class="game-area card">
      <div class="progress-info">
        <span id="progressText">Question 1 / 30</span>
        <span id="timeDisplay">5:00</span>
      </div>
      <div class="progress-bar">
        <div id="progressFill" class="progress-fill"></div>
      </div>
      <div id="question" class="question">7 √ó 8 = ?</div>
      <input type="number" id="answerInput" class="answer-input" placeholder="?">
      <br><br>
      <button id="validateBtn" class="btn-primary">Valider</button>
      <button id="pauseBtn" class="btn-primary">Pause</button>
      <button id="stopBtn" class="btn-primary">Arr√™ter</button>
    </section>

    <!-- Zone r√©sultats (inchang√©e) -->
    <section id="resultsArea" class="results-area card">
      <h2>R√©sultats de votre test</h2>
      <div id="medal" class="medal">üèÜ</div>
      <div id="medalText">OR</div>
      <div class="results-grid">
        <div class="result-item"><div>Score global :</div><div id="finalScore" class="result-value">0/30</div></div>
        <div class="result-item"><div>Bonnes r√©ponses :</div><div id="correctCount" class="result-value">0</div></div>
        <div class="result-item"><div>Mauvaises r√©ponses :</div><div id="incorrectCount" class="result-value">0</div></div>
        <div class="result-item"><div>Non r√©pondues :</div><div id="missedCount" class="result-value">0</div></div>
      </div>
      <div class="result-item"><div>Pourcentage de r√©ussite :</div><div id="successPercentage" class="result-value">0%</div></div>
      <h3>Grille des r√©sultats 12√ó12 :</h3>
      <div class="results-grid">
        <table id="resultsGrid"></table>
      </div>
      <div style="margin:20px 0;">
        <div style="display:inline-block;margin:0 10px;"><span style="display:inline-block;width:20px;height:20px;background:transparent;border:1px solid #666;margin-right:5px;"></span>R√©ponse correcte</div>
        <div style="display:inline-block;margin:0 10px;"><span style="display:inline-block;width:20px;height:20px;background:#f44;margin-right:5px;"></span>R√©ponse incorrecte</div>
        <div style="display:inline-block;margin:0 10px;"><span style="display:inline-block;width:20px;height:20px;background:#ff0;margin-right:5px;"></span>Non r√©pondu</div>
      </div>
      <h3>Liste d√©taill√©e des erreurs :</h3>
      <div id="errorsList"></div>
      <button id="newGameBtn" class="btn-primary">Nouvelle s√©rie</button>
      <button id="backToSettingsBtn" class="btn-primary">Modifier les param√®tres</button>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-logo">
        <img src="logofTDSR.png" alt="Logo DSR">
      </div>
      <div class="footer-text">
        Con√ßu et d√©velopp√© par DSR / edlam.dsr@gmail.com
      </div>
    </footer>
  </div>
  
  <script>
    // ========== DONN√âES DES ASTUCES ==========
    const ASTUCES = {
      1: [
        "üü¢ Facile ! Quand tu multiplies par 1, le nombre reste toujours pareil !",
        "‚Ä¢ Exemples : 1 √ó 5 = 5, 1 √ó 8 = 8, 1 √ó 12 = 12",
        "‚Ä¢ Astuce : Le 1 n'a pas de pouvoir magique, il ne change rien !",
        "‚Ä¢ Entra√Æne-toi : dis \"1 fois 7 √©gale 7\" √† voix haute"
      ],
      2: [
        "üü¢ C'est la table des doubles !",
        "‚Ä¢ Prends le nombre et double-le : 2 √ó 4 = 4 + 4 = 8",
        "‚Ä¢ Compte de 2 en 2 : 2, 4, 6, 8, 10, 12, 14...",
        "‚Ä¢ Astuce : Imagine 2 paquets identiques d'objets",
        "‚Ä¢ Tous les r√©sultats sont des nombres pairs !"
      ],
      3: [
        "üü† Compte de 3 en 3 comme √† la marelle !",
        "‚Ä¢ R√©cite : 3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36",
        "‚Ä¢ Pour 3 √ó 4 = fais 3 + 3 + 3 + 3 = 12",
        "‚Ä¢ Astuce : Saute de 3 cases √† chaque fois !",
        "‚Ä¢ Dessine 3 objets, puis encore 3, puis encore 3..."
      ],
      4: [
        "üü† Double deux fois !",
        "‚Ä¢ Prends le nombre, double-le, puis double encore",
        "‚Ä¢ Exemple : 4 √ó 3 = 3 + 3 = 6, puis 6 + 6 = 12",
        "‚Ä¢ Astuce : 4 = 2 + 2, alors fais deux fois la table de 2 !",
        "‚Ä¢ Compte : 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48"
      ],
      5: [
        "üü¢ Tous les r√©sultats finissent par 0 ou 5 !",
        "‚Ä¢ R√©cite : 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60",
        "‚Ä¢ R√®gle magique : nombres pairs √ó 5 finissent par 0",
        "‚Ä¢ Nombres impairs √ó 5 finissent par 5",
        "‚Ä¢ Compte sur tes doigts : 5, 10 (une main compl√®te !)"
      ],
      6: [
        "üü† R√©cite la suite magique !",
        "‚Ä¢ 6, 12, 18, 24, 30, 36, 42, 48, 54, 60, 66, 72",
        "‚Ä¢ Compte sur tes doigts : sur chaque doigt dis 6, 12, 18...",
        "‚Ä¢ Astuce : Chante cette suite comme une chanson !",
        "‚Ä¢ 6 √ó nombre pair = r√©sultat finit par 2, 4, 6, 8, 0"
      ],
      7: [
        "üî¥ Pense aux jours de la semaine !",
        "‚Ä¢ 7 jours = 1 semaine, 14 jours = 2 semaines...",
        "‚Ä¢ 7 √ó 4 = 28 (4 semaines = 1 mois !)",
        "‚Ä¢ Retiens : 7 √ó 8 = 56 (sept-huit = cinquante-six)",
        "‚Ä¢ Compte : 7, 14, 21, 28, 35, 42, 49, 56, 63, 70, 77, 84"
      ],
      8: [
        "üî¥ Double trois fois !",
        "‚Ä¢ Pour 8 √ó 2 : 2 ‚Üí 4 ‚Üí 8 ‚Üí 16",
        "‚Ä¢ (2+2=4, puis 4+4=8, puis 8+8=16)",
        "‚Ä¢ Astuce : 8 c'est 2√ó2√ó2, alors triple le doublement !",
        "‚Ä¢ Compte : 8, 16, 24, 32, 40, 48, 56, 64, 72, 80, 88, 96"
      ],
      9: [
        "üü† Magique ! Les chiffres du r√©sultat font toujours 9 !",
        "‚Ä¢ 9 √ó 4 = 36, et 3 + 6 = 9",
        "‚Ä¢ 9 √ó 7 = 63, et 6 + 3 = 9",
        "‚Ä¢ Astuce doigts : pour 9√ó3, baisse le 3e doigt = 27 !",
        "‚Ä¢ Compte : 9, 18, 27, 36, 45, 54, 63, 72, 81, 90, 99, 108"
      ],
      10: [
        "üü¢ Super facile ! Ajoute juste un 0 !",
        "‚Ä¢ 10 √ó 7 = 70 (√©cris 7 puis 0)",
        "‚Ä¢ 10 √ó 12 = 120 (√©cris 12 puis 0)",
        "‚Ä¢ Astuce : 10 c'est magique, il transforme tout !",
        "‚Ä¢ Compte : 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120"
      ],
      11: [
        "üü† Pour 1 √† 9, √©cris le chiffre deux fois !",
        "‚Ä¢ 11 √ó 4 = 44 (√©cris 4 puis 4)",
        "‚Ä¢ 11 √ó 7 = 77 (√©cris 7 puis 7)",
        "‚Ä¢ Pour 10, 11, 12 c'est diff√©rent mais facile √† retenir !",
        "‚Ä¢ Compte : 11, 22, 33, 44, 55, 66, 77, 88, 99, 110, 121, 132"
      ],
      12: [
        "üî¥ La douzaine ! Compte par 12 !",
        "‚Ä¢ 12, 24, 36, 48, 60, 72, 84, 96, 108, 120, 132, 144",
        "‚Ä¢ Pense √† une douzaine d'≈ìufs !",
        "‚Ä¢ 12 √ó 5 = 60 (5 douzaines d'≈ìufs)",
        "‚Ä¢ Astuce : 12 = 10 + 2, alors 12√ó4 = 40+8 = 48"
      ]
    };

    // ---- JS principal (inchang√©) ----
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.querySelector('.theme-icon');
    // Th√®me
    function setTheme(mode) {
      document.body.classList.toggle('day-mode', mode === 'day');
      themeIcon.textContent = (mode === 'day') ? '‚òÄÔ∏è' : 'üåô';
      localStorage.setItem('tma_theme', mode);
    }
    let currentTheme = localStorage.getItem('tma_theme') || 'night';
    setTheme(currentTheme);

    themeToggle.onclick = () => {
      currentTheme = (currentTheme === 'day') ? 'night' : 'day';
      setTheme(currentTheme);
    };

    // ========== NAVIGATION APPRENTISSAGE ==========
    const learnBtn = document.getElementById('learnBtn');
    const learnPage = document.getElementById('learnPage');
    const homePage = document.getElementById('homePage');
    const backHome = document.getElementById('backHome');
    const tableDetailPage = document.getElementById('tableDetailPage');
    const backToLearnBtn = document.getElementById('backToLearnBtn');

    // Variables globales
    let currentTableNum = 1;

    // Aller vers apprentissage
    learnBtn.onclick = () => {
      homePage.style.display = 'none';
      learnPage.style.display = 'block';
      tableDetailPage.style.display = 'none';
      document.getElementById('gameArea').style.display = 'none';
      document.getElementById('resultsArea').style.display = 'none';
      window.scrollTo(0, 0);
    };

    // Retour vers accueil
    backHome.onclick = () => {
      learnPage.style.display = 'none';
      tableDetailPage.style.display = 'none';
      homePage.style.display = 'block';
      document.getElementById('gameArea').style.display = 'none';
      document.getElementById('resultsArea').style.display = 'none';
      window.scrollTo(0, 0);
    };

    // Retour vers liste des tables
    backToLearnBtn.onclick = () => {
      tableDetailPage.style.display = 'none';
      learnPage.style.display = 'block';
      window.scrollTo(0, 0);
    };

    // Clic sur une table ‚Üí afficher d√©tail
    document.querySelectorAll('.table-card').forEach(card => {
      card.onclick = () => {
        currentTableNum = parseInt(card.dataset.num);
        showTableDetail(currentTableNum);
      };
    });

    // Afficher page d√©tail d'une table
    function showTableDetail(tableNum) {
      learnPage.style.display = 'none';
      tableDetailPage.style.display = 'block';
      
      // Mettre √† jour le titre
      document.getElementById('tableDetailTitle').textContent = `Table de ${tableNum}`;
      
      // G√©n√©rer la grille des multiplications
      const grid = document.getElementById('multiplicationGrid');
      grid.innerHTML = '';
      
      for (let i = 1; i <= 12; i++) {
        const card = document.createElement('div');
        card.className = 'mult-card';
        card.innerHTML = `
          <div class="mult-question">${tableNum} √ó ${i} =</div>
          <div class="mult-answer">${tableNum * i}</div>
        `;
        grid.appendChild(card);
      }
      
      window.scrollTo(0, 0);
    }

    // ========== MODAL ASTUCES ==========
    const showAstuceBtn = document.getElementById('showAstuceBtn');
    const astuceModal = document.getElementById('astuceModal');
    const closeAstuceModal = document.getElementById('closeAstuceModal');
    const astuceModalTitle = document.getElementById('astuceModalTitle');
    const astuceModalContent = document.getElementById('astuceModalContent');

    // Ouvrir modal astuce
    showAstuceBtn.onclick = () => {
      astuceModalTitle.textContent = `Astuces Table de ${currentTableNum}`;
      
      // Remplir le contenu
      astuceModalContent.innerHTML = '';
      ASTUCES[currentTableNum].forEach(astuce => {
        const li = document.createElement('li');
        li.textContent = astuce;
        astuceModalContent.appendChild(li);
      });
      
      astuceModal.classList.add('active');
    };

    // Fermer modal astuce
    closeAstuceModal.onclick = () => {
      astuceModal.classList.remove('active');
    };

    // Fermer modal en cliquant √† l'ext√©rieur
    astuceModal.onclick = (e) => {
      if (e.target === astuceModal) {
        astuceModal.classList.remove('active');
      }
    };

    // ========== FIN NAVIGATION APPRENTISSAGE ==========

    // ---- STOCKAGE et init param√®tres (inchang√©) ----
    const prefsKey = 'tma_prefs_v2';
    function savePrefs() {
      localStorage.setItem(prefsKey, JSON.stringify({
        tables: getTables(),
        questionCount: questionCount.value,
        timeLimit: timeLimit.value,
        noTimerMode: noTimerMode.checked
      }));
    }
    function loadPrefs() {
      const p = JSON.parse(localStorage.getItem(prefsKey)||'null');
      if (!p) return;
      document.querySelectorAll('.tables-selector input').forEach((cb,i) => cb.checked=(p.tables||[]).includes(i+1));
      questionCount.value = p.questionCount||"30";
      timeLimit.value = p.timeLimit||"5";
      noTimerMode.checked = !!p.noTimerMode;
      updateTimeLimitLabel();
      updateButtonText();
    }
    // -- DOM refs --
    const questionCount = document.getElementById('questionCount');
    const timeLimit = document.getElementById('timeLimit');
    const timeLimitLabel = document.getElementById('timeLimitLabel');
    const noTimerMode = document.getElementById('noTimerMode');
    function updateTimeLimitLabel() {
      timeLimitLabel.textContent = `Temps pour ta s√©rie de ${questionCount.value} questions :`;
    }
    questionCount.addEventListener('change', ()=> {
      updateTimeLimitLabel(); savePrefs();
    });
    timeLimit.addEventListener('change', savePrefs);
    noTimerMode.addEventListener('change', ()=>{updateButtonText();savePrefs();});
    document.querySelectorAll('.tables-selector input').forEach(cb => {
      cb.addEventListener('change', savePrefs);
    });
    // Bouton dynamique
    const startGame = document.getElementById('startGame');
    function updateButtonText(){
      startGame.textContent = noTimerMode.checked ? "Commencer l'entra√Ænement" : "Commencer le Test";
    }
    loadPrefs();

    // ---- Logique du jeu (inchang√©e) ----
    let GAME = {};
    // Utilitaires
    function getTables(){
      return Array.from(document.querySelectorAll('.tables-selector input:checked')).map(cb=>parseInt(cb.value));
    }
    function secToMMSS(s) {
      const m = Math.floor(s/60), sec = (s%60).toString().padStart(2,'0');
      return `${m}:${sec}`;
    }
    // Barre progression
    function updateProgressBar(){
      progressFill.style.width = ((GAME.idx)/GAME.nbQuestions*100)+'%';
      progressText.textContent = `Question ${Math.min(GAME.idx+1,GAME.nbQuestions)} / ${GAME.nbQuestions}`;
    }
    function updateTimerDisplay(){
      if (GAME.noTimerMode) timeDisplay.textContent = '';
      else timeDisplay.textContent = secToMMSS(GAME.timeLeft);
    }
    // G√©n√©ration + d√©marrage partie
    function generateSerie(){
      let tables = GAME.tables;
      let serie = [];
      for(let i=0;i<GAME.nbQuestions;i++) {
        let a = tables[Math.floor(Math.random()*tables.length)];
        let b = Math.floor(Math.random()*12)+1;
        serie.push({a,b,r:a*b});
      }
      return serie;
    }
    // D√©marrage
    startGame.onclick = () => {
      GAME = {
        tables: getTables(), nbQuestions: parseInt(questionCount.value), timeLimit: parseFloat(timeLimit.value)*60,
        noTimerMode: noTimerMode.checked,
        idx:0, score:0, timer:null, timeLeft:0, serie:[], userAnswers:[]
      };
      if (GAME.tables.length===0) {alert('S√©lectionnez au moins une table'); return;}
      GAME.serie = generateSerie();
      GAME.timeLeft = GAME.noTimerMode?0:GAME.timeLimit;
      GAME.userAnswers = [];
      showGame();
      showQuestion();
      if (!GAME.noTimerMode) {
        GAME.timer = setInterval(()=>{
          GAME.timeLeft--;
          updateTimerDisplay();
          if (GAME.timeLeft<=0) endGame();
        }, 1000);
      }
      updateTimerDisplay();
      updateProgressBar();
      savePrefs();
    };
    // Affichage des zones
    function showGame(){
      document.querySelector('.settings-panel').style.display='none';
      document.querySelector('.welcome-message').style.display='none';
      document.getElementById('gameArea').style.display='block';
      document.getElementById('resultsArea').style.display='none';
      document.getElementById('homePage').style.display='none';
      document.getElementById('learnPage').style.display='none';
      document.getElementById('tableDetailPage').style.display='none';
    }
    function showResults(){
      document.querySelector('.settings-panel').style.display='none';
      document.querySelector('.welcome-message').style.display='none';
      document.getElementById('gameArea').style.display='none';
      document.getElementById('resultsArea').style.display='block';
      document.getElementById('homePage').style.display='none';
      document.getElementById('learnPage').style.display='none';
      document.getElementById('tableDetailPage').style.display='none';
    }
    function showSettings(){
      document.querySelector('.settings-panel').style.display='block';
      document.querySelector('.welcome-message').style.display='block';
      document.getElementById('gameArea').style.display='none';
      document.getElementById('resultsArea').style.display='none';
      document.getElementById('homePage').style.display='block';
      document.getElementById('learnPage').style.display='none';
      document.getElementById('tableDetailPage').style.display='none';
    }
    // Affichage question
    const progressText=document.getElementById('progressText');
    const progressFill=document.getElementById('progressFill');
    const timeDisplay=document.getElementById('timeDisplay');
    const questionDiv=document.getElementById('question');
    const answerInput=document.getElementById('answerInput');
    const validateBtn=document.getElementById('validateBtn');
    function showQuestion(){
      let q=GAME.serie[GAME.idx];
      questionDiv.textContent = `${q.a} √ó ${q.b} = ?`;
      answerInput.value = '';
      answerInput.focus();
      updateProgressBar();
      updateTimerDisplay();
    }
    // Validation r√©ponse
    function doValidate(){
      let ans = parseInt(answerInput.value); 
      if (isNaN(ans)) ans = null;
      GAME.userAnswers.push(ans);
      if (ans === GAME.serie[GAME.idx].r) GAME.score++;
      GAME.idx++;
      if (GAME.idx>=GAME.nbQuestions) endGame();
      else showQuestion();
    }
    validateBtn.onclick = doValidate;
    answerInput.addEventListener('keypress', e=>{
      if (e.key==="Enter") doValidate();
    });
    // Pause & Arr√™t
    pauseBtn.onclick = function(){
      if (GAME.timer) {
        clearInterval(GAME.timer);
        GAME.timer=null;
        pauseBtn.textContent="Reprendre";
        validateBtn.disabled = true;
        answerInput.disabled = true;
      } else {
        GAME.timer = setInterval(()=>{
          GAME.timeLeft--;
          updateTimerDisplay();
          if (GAME.timeLeft<=0) endGame();
        }, 1000);
        pauseBtn.textContent="Pause";
        validateBtn.disabled = false;
        answerInput.disabled = false;
        answerInput.focus();
      }
    };
    stopBtn.onclick = function(){
      if (GAME.timer) clearInterval(GAME.timer);
      showSettings();
    };
    // Fin de partie
    // Affichage r√©sultats
    const medalElem = document.getElementById('medal');
    const medalText = document.getElementById('medalText');
    const finalScore = document.getElementById('finalScore');
    const correctCount = document.getElementById('correctCount');
    const incorrectCount = document.getElementById('incorrectCount');
    const missedCount = document.getElementById('missedCount');
    const successPercentage = document.getElementById('successPercentage');
    function endGame(){
      if (GAME.timer) clearInterval(GAME.timer);
      showResults();
      let answered = GAME.userAnswers.length;
      let nbQuestions = GAME.nbQuestions;
      let good = 0, bad = 0, miss=0;
      for(let i=0;i<nbQuestions;i++){
        if (typeof GAME.userAnswers[i]==="number") {
          if (GAME.userAnswers[i]===GAME.serie[i].r) good++;
          else bad++;
        } else miss++;
      }
      finalScore.textContent = `${good}/${nbQuestions}`;
      correctCount.textContent = good;
      incorrectCount.textContent = bad;
      missedCount.textContent = miss;
      let pct = nbQuestions===0 ? 0 : Math.round(100*good/nbQuestions);
      successPercentage.textContent = `${pct}%`;
      // M√©dailles
      let medal = "üèÜ", medalName = "OR";
      if (nbQuestions == 10) { // Sp√©cial 10 questions
        if(pct>=90){medal="üèÜ";medalName="OR";}
        else if(pct>=80){medal="ü•à";medalName="ARGENT";}
        else if(pct>=70){medal="ü•â";medalName="BRONZE";}
        else{medal=medalBlanche();medalName="PAPIER";}
      } else {
        if(pct>=98){medal="üèÜ";medalName="OR";}
        else if(pct>=95){medal="ü•à";medalName="ARGENT";}
        else if(pct>=90){medal="ü•â";medalName="BRONZE";}
        else{medal=medalBlanche();medalName="PAPIER";}
      }
      medalElem.innerHTML = medal;
      medalText.innerHTML = medalName;
      document.getElementById('resultsGrid').innerHTML = buildResultsGrid(GAME.serie, GAME.userAnswers);
      document.getElementById('errorsList').innerHTML = buildErrorsList(GAME.serie, GAME.userAnswers);
    }
    function medalBlanche(){
      // SVG blanc avec "4"
      return `<svg width="64" height="64"><circle cx="32" cy="32" r="30" fill="#fff" stroke="#ccc" stroke-width="4"/><text x="32" y="44" text-anchor="middle" font-size="40" fill="#333" font-family="Arial" font-weight="bold">4</text></svg>`;
    }
    // Grille r√©sultats - ERREUR CORRIG√âE ICI
    function buildResultsGrid(serie, userAnswers){
      let html = '<tr><th>√ó</th>';
      for(let i=1;i<=12;i++) html+=`<th>${i}</th>`;
      html+='</tr>';
      for(let a=1;a<=12;a++){
        html+=`<tr><th>${a}</th>`; // CORRIG√â : accolade ferm√©e
        for(let b=1;b<=12;b++){
          let klass = '';
          for(let i=0;i<serie.length;i++){
            if(serie[i].a===a && serie[i].b===b){
              if(userAnswers[i]===serie[i].r) klass='cell-correct';
              else if(userAnswers[i]==null) klass='cell-missed';
              else klass='cell-incorrect';
              break;
            }
          }
          html += `<td class="${klass}">${a*b}</td>`;
        }
        html+='</tr>';
      }
      return html;
    }
    // Liste erreurs d√©taill√©es
    function buildErrorsList(serie, userAnswers){
      let html = '';
      for(let i=0;i<serie.length;i++){
        if (typeof userAnswers[i]==="number" && userAnswers[i]!==serie[i].r){
          html += `<div>${serie[i].a}&times;${serie[i].b} = ${serie[i].r} <span style="color:#f44"> (r√©ponse : ${userAnswers[i]})</span></div>`;
        } else if (userAnswers[i]==null){
          html += `<div>${serie[i].a}&times;${serie[i].b} = ${serie[i].r} <span style="color:#ff0;"> (Non r√©pondu)</span></div>`;
        }
      }
      if (!html) html = "<div>Aucune erreur üëç</div>";
      return html;
    }
    // Actions fin (nouvelle s√©rie / param√®tres)
    document.getElementById('newGameBtn').onclick = () => startGame.onclick();
    document.getElementById('backToSettingsBtn').onclick = () => showSettings();

    // Initial State
    showSettings();
  </script>
</body>
</html>
