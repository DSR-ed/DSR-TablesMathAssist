<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DSR Tables Math Assist</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;font-family:"Segoe UI",Arial,Helvetica,sans-serif;background:#000;color:#fff;display:flex;flex-direction:column;align-items:center}
  header{position:sticky;top:0;display:flex;justify-content:space-around;align-items:center;width:100%;padding:10px 0;background:#000;font-size:6vw;color:#0af;z-index:10}
  header button{font-size:4vw;padding:6px 18px;border:none;border-radius:10px;color:#000;cursor:pointer}
  #btnStart{background:#0f0}
  #btnReset{background:#f44}
  #btnTables{background:#00f;color:#fff}
  #btnParams{background:transparent;color:#fff;font-size:4.5vw}
  #btnTables:disabled,#btnParams:disabled,#btnStart.disabled,#okBtn.disabled{opacity:.5;pointer-events:none}
  main{flex:1;width:100%;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:20px}
  #question{font-size:10vw;font-weight:700;margin:20px 0;text-align:center}
  #reponse{font-size:8vw;width:60vw;max-width:320px;text-align:center;border:none;border-radius:15px;padding:15px;margin-bottom:20px}
  #okBtn{font-size:5vw;padding:14px 50px;border:none;border-radius:15px;background:#0f0;color:#000;cursor:pointer}
  section{width:100%;max-width:800px}
  #zoneFin,#zoneTables,#zoneParams{display:none;margin-top:20px;padding:0 20px}
  #zoneFin h2{color:#0af;margin:10px 0 5px}
  #zoneFin ul{list-style:none;font-size:5vw}
  @media(min-width:600px){#zoneFin ul{font-size:2vw}}
  .faute{color:#f44}.manquee{color:#ff0}
  /* TABLES */
  #grille table{margin:0 auto;border-collapse:collapse;font-size:4vw}
  #grille th,#grille td{border:1px solid #fff;width:12vw;height:12vw;text-align:center}
  #grille th{background:#0af;color:#000;font-weight:700}
  @media(min-width:600px){#grille th,#grille td{width:6vw;height:6vw;font-size:1.6vw}}
  #liste{margin-top:25px}
  #liste h4{color:#0af;font-size:5vw;text-align:center;margin-bottom:8px}
  #liste>div{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;font-size:4.2vw}
  @media(min-width:600px){#liste h4{font-size:2.2vw}#liste>div{font-size:1.8vw}}
  /* PARAMS */
  #zoneParams h3{color:#0af;text-align:center;margin-bottom:10px}
  #zoneParams label{display:block;margin:10px 0;font-size:5vw}
  @media(min-width:600px){#zoneParams label{font-size:2.2vw}}
  #zoneParams input[type=number]{width:100px;font-size:inherit;margin-left:8px;border-radius:6px;border:none;padding:4px}
  #zoneParams input[type=checkbox]{transform:scale(1.4);margin-right:8px}
  button{transition:transform .1s}button:active{transform:scale(.95)}
</style>
</head>
<body>

<header>
  <button id="btnStart">D√âPART</button>
  <span id="timer">4:00</span>
  <button id="btnReset">RESET</button>
  <button id="btnTables">TABLES</button>
  <button id="btnParams" title="Param√®tres">‚öôÔ∏è</button>
</header>

<main id="zoneJeu">
  <div id="question"></div>
  <input id="reponse" type="number" inputmode="numeric" autocomplete="off">
  <button id="okBtn" class="disabled">OK</button>
</main>

<section id="zoneFin">
  <h2>R√©sultats</h2>
  <div id="scoreFinal"></div>
  <h2 class="faute">Fautes</h2>
  <ul id="listeFautes"></ul>
  <h2 class="manquee">Manqu√©es</h2>
  <ul id="listeManquees"></ul>
  <button id="btnNew" style="font-size:5vw;padding:14px 40px;background:#0af;color:#000;border:none;border-radius:12px;margin-top:15px">Nouvelle s√©rie</button>
</section>

<section id="zoneTables">
  <h3 style="color:#0af;text-align:center;margin-bottom:10px">Tables 1 ‚Äì 12</h3>
  <div id="grille"><table id="tableGrille"></table></div>
  <div id="liste"></div>
  <button id="btnBackResults" style="font-size:5vw;padding:14px 40px;background:#0af;color:#000;border:none;border-radius:12px;margin:25px auto 0;display:block">Retour aux r√©sultats</button>
</section>

<section id="zoneParams">
  <h3>Param√®tres</h3>
  <label>Temps (secondes) :
    <input type="number" id="inputTime" min="1" max="1200" value="240">
  </label>
  <label>Nombre de questions :
    <input type="number" id="inputNb" min="10" max="500" value="50">
  </label>
  <div>Tables √† inclure :</div>
  <div id="checkTables" style="margin-top:6px"></div>
  <button id="btnApplyParams" style="font-size:5vw;padding:12px 36px;background:#0af;color:#000;border:none;border-radius:12px;margin-top:18px">Appliquer</button>
</section>

<script>
/* -------------------- PARAM√àTRES -------------------- */
let tempsChoisi = 240,
    nbQuestions = 50,
    tempsRestant = tempsChoisi,
    tablesActives = Array.from({length:12},(_,i)=>i+1),
    tableColors = {};

/* -------------------- OUTILS -------------------- */
const secToMMSS = s => `${Math.floor(s/60)}:${('0'+s%60).slice(-2)}`;

/* -------------------- UI PARAMS -------------------- */
function buildCheckTables(){
  const div = document.getElementById('checkTables');
  div.innerHTML = '';
  for(let t=1;t<=12;t++){
    const lbl = document.createElement('label');
    lbl.style.marginRight = '12px';
    const cb = document.createElement('input');
    cb.type = 'checkbox';
    cb.checked = tablesActives.includes(t);
    cb.dataset.table = t;
    lbl.append(cb, ` Table ${t}`);
    div.appendChild(lbl);
  }
}
function applyParams(){
  tempsChoisi   = Math.max(1,Math.min(1200, +document.getElementById('inputTime').value || 240));
  nbQuestions   = Math.max(10,Math.min(500 , +document.getElementById('inputNb').value   || 50 ));
  tablesActives = [...document.querySelectorAll('#checkTables input:checked')]
                  .map(e=>+e.dataset.table);
  if(!tablesActives.length){ alert('Coche au moins une table.'); return; }
  tempsRestant = tempsChoisi;
  document.getElementById('timer').textContent = secToMMSS(tempsRestant);
  toggleParams();
  reset();
}

/* -------------------- TABLES -------------------- */
function buildTables(){
  /* grille 12√ó12 */
  const tbl = document.getElementById('tableGrille');
  tbl.innerHTML = '';
  let header = '<tr><th>√ó</th>';
  for(let i=1;i<=12;i++) header += `<th>${i}</th>`;
  header += '</tr>';
  tbl.insertAdjacentHTML('beforeend', header);
  for(let a=1;a<=12;a++){
    let row = `<tr><th>${a}</th>`;
    for(let b=1;b<=12;b++){
      const key = `${a}-${b}`, color = tableColors[key]||'transparent';
      row += `<td style="background:${color}">${a*b}</td>`;
    }
    row += '</tr>';
    tbl.insertAdjacentHTML('beforeend', row);
  }
  /* liste verticale */
  const liste = document.getElementById('liste');
  liste.innerHTML = '';
  for(let a=1;a<=12;a++){
    liste.insertAdjacentHTML('beforeend', `<h4>Table de ${a}</h4>`);
    const div = document.createElement('div');
    for(let b=1;b<=12;b++){
      const key = `${a}-${b}`, col = tableColors[key]||'transparent';
      const box = `<span style="background:${col};padding:4px 8px;border-radius:6px">${a}√ó${b}=${a*b}</span>`;
      div.insertAdjacentHTML('beforeend', box);
    }
    liste.append(div);
  }
}

/* -------------------- EXERCICE -------------------- */
let serie = [], idx = 0, score = 0, timer = null, started = false, reponsesUser = [];

function pickFactor(){ return tablesActives[Math.floor(Math.random()*tablesActives.length)]; }

function genererSerie(){
  serie = []; reponsesUser = []; tableColors = {};
  for(let i=0;i<nbQuestions;i++){
    const a = pickFactor(), b = pickFactor();
    serie.push({a,b,r:a*b});
    reponsesUser.push(null);
  }
  buildTables();
}

function afficherQuestion(){
  const q = serie[idx];
  document.getElementById('question').textContent = `${q.a} √ó ${q.b} = ?`;
  document.getElementById('reponse').value = '';
  document.getElementById('reponse').focus();
}

function start(){
  if(started) return;
  started = true;
  document.getElementById('btnStart').classList.add('disabled');
  document.getElementById('btnTables').disabled = true;
  document.getElementById('btnParams').disabled = true;
  document.getElementById('okBtn').classList.remove('disabled');
  timer = setInterval(()=>{
    tempsRestant--;
    document.getElementById('timer').textContent = secToMMSS(tempsRestant);
    if(tempsRestant<=0 || idx>=nbQuestions) finSerie();
  },1000);
}

function reset(){
  clearInterval(timer);
  started = false; idx = 0; score = 0; tempsRestant = tempsChoisi;
  document.getElementById('timer').textContent = secToMMSS(tempsRestant);
  document.getElementById('btnStart').classList.remove('disabled');
  document.getElementById('btnTables').disabled = false;
  document.getElementById('btnParams').disabled = false;
  document.getElementById('okBtn').classList.add('disabled');
  document.getElementById('zoneJeu').style.display   = 'flex';
  document.getElementById('zoneFin').style.display    = 'none';
  document.getElementById('zoneTables').style.display = 'none';
  document.getElementById('zoneParams').style.display = 'none';
  genererSerie(); afficherQuestion();
}

function valider(){
  if(!started) return;
  const val = parseInt(document.getElementById('reponse').value,10);
  reponsesUser[idx] = isNaN(val)?null:val;
  const key = `${serie[idx].a}-${serie[idx].b}`;
  if(val === serie[idx].r){ score++; }
  else if(val !== null){ tableColors[key] = '#f44'; }
  idx++;
  if(idx < nbQuestions) afficherQuestion();
  else finSerie();
}

function getMedal(){
  const pct = score/nbQuestions;
  if(pct>=0.9) return 'üèÖ OR';
  if(pct>=0.75) return 'ü•à ARGENT';
  if(pct>=0.6) return 'ü•â BRONZE';
  return 'üìÑ PAPIER';
}

function finSerie(){
  clearInterval(timer);
  serie.forEach((q,i)=>{ if(reponsesUser[i]===null) tableColors[`${q.a}-${q.b}`] = '#ff0'; });
  buildTables();
  document.getElementById('zoneJeu').style.display   = 'none';
  document.getElementById('zoneTables').style.display = 'none';
  document.getElementById('zoneFin').style.display    = 'block';
  document.getElementById('btnTables').disabled = false;
  document.getElementById('btnParams').disabled = false;

  document.getElementById('scoreFinal').textContent =
    `Score : ${score} / ${nbQuestions}   ‚Üí   ${getMedal()}`;

  const fautesUL    = document.getElementById('listeFautes');
  const manqueesUL  = document.getElementById('listeManquees');
  fautesUL.innerHTML = manqueesUL.innerHTML = '';

  serie.forEach((q,i)=>{
    const user = reponsesUser[i];
    if(user!==q.r){
      const li = document.createElement('li');
      li.textContent = `${q.a} √ó ${q.b} = ${q.r}` + (user!==null?` (ta r√©ponse : ${user})`:'');
      li.className = user===null?'manquee':'faute';
      (user===null?manqueesUL:fautesUL).append(li);
    }
  });
}

/* -------------------- NAVIGATION -------------------- */
function toggleTables(){
  const zt = document.getElementById('zoneTables');
  const zj = document.getElementById('zoneJeu');
  const zf = document.getElementById('zoneFin');
  const zp = document.getElementById('zoneParams');
  const show = zt.style.display === 'none' || !zt.style.display;
  zt.style.display = show?'block':'none';
  zj.style.display = show?'none':'flex';
  zf.style.display = 'none';
  zp.style.display = 'none';
}
function toggleParams(){
  const zp = document.getElementById('zoneParams');
  const zj = document.getElementById('zoneJeu');
  const zf = document.getElementById('zoneFin');
  const zt = document.getElementById('zoneTables');
  const show = zp.style.display === 'none' || !zp.style.display;
  zp.style.display = show?'block':'none';
  zj.style.display = show?'none':'flex';
  zf.style.display = 'none';
  zt.style.display = 'none';
}

/* -------------------- INIT -------------------- */
buildCheckTables();
genererSerie();
reset();

/* -------------------- LISTENERS -------------------- */
document.getElementById('btnStart')      .addEventListener('click',start);
document.getElementById('btnReset')      .addEventListener('click',reset);
document.getElementById('btnTables')     .addEventListener('click',toggleTables);
document.getElementById('btnParams')     .addEventListener('click',toggleParams);
document.getElementById('okBtn')         .addEventListener('click',valider);
document.getElementById('reponse')       .addEventListener('keydown',e=>{ if(e.key==='Enter') valider(); });
document.getElementById('btnBackResults').addEventListener('click',()=>{
  document.getElementById('zoneTables').style.display='none';
  document.getElementById('zoneFin').style.display='block';
});
document.getElementById('btnNew')        .addEventListener('click',reset);
document.getElementById('btnApplyParams').addEventListener('click',applyParams);
</script>
</body>
</html>
